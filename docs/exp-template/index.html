<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Phrase Expander Template</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 1.5rem;
      max-width: 900px;
      margin-inline: auto;
      line-height: 1.4;
      background: #f5f5f5;
    }
    h1 {
      font-size: 1.6rem;
      margin-bottom: 0.5rem;
    }
    .container {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.2fr);
      gap: 1.5rem;
      align-items: flex-start;
    }
    fieldset {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1rem 1.2rem;
      margin-bottom: 1rem;
      background: #fff;
    }
    legend {
      font-weight: 600;
      padding: 0 0.4rem;
    }
    label {
      display: block;
      margin-bottom: 0.25rem;
    }
    .horizontal label {
      display: inline-flex;
      align-items: center;
      margin-right: 1rem;
    }
    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem 0.75rem;
    }
    .chips label {
      display: inline-flex;
      align-items: center;
      padding: 0.15rem 0.4rem;
      border-radius: 999px;
      border: 1px solid #ddd;
      background: #fafafa;
      font-size: 0.9rem;
    }
    textarea {
      width: 100%;
      min-height: 420px;
      resize: vertical;
      padding: 0.75rem;
      font-family: "SF Mono", Menlo, Consolas, monospace;
      font-size: 0.9rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      background: #111;
      color: #f7f7f7;
      white-space: pre;
    }
    .output-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.4rem;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 0.35rem 0.9rem;
      font-size: 0.9rem;
      cursor: pointer;
      background: #2563eb;
      color: #fff;
    }
    button:active {
      transform: scale(0.98);
    }
    .small {
      font-size: 0.8rem;
      color: #666;
    }

    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
      }
      textarea {
        min-height: 260px;
      }
    }
  </style>
</head>
<body>
  <h1>Phrase Expander</h1>
  <p class="small">
    Adjust options on the left; the text is generated on the right. Click “Copy” to grab the whole output.
  </p>

  <div class="container">
    <!-- LEFT: controls -->
    <div>
      <!-- 1. Radio buttons for basic variants -->
      <fieldset>
        <legend>Visit Type</legend>
        <div class="horizontal">
          <label>
            <input type="radio" name="visitType" value="new" checked />
            New Patient
          </label>
          <label>
            <input type="radio" name="visitType" value="followup" />
            Follow-up
          </label>
          <label>
            <input type="radio" name="visitType" value="urgent" />
            Urgent / Work-in
          </label>
        </div>
      </fieldset>

      <!-- 2. Multi-select meds (checkboxes as “chips”) -->
      <fieldset>
        <legend>Medications</legend>
        <p class="small">Select all that apply.</p>
        <div class="chips">
          <label>
            <input type="checkbox" class="med-checkbox" value="levetiracetam" />
            Levetiracetam
          </label>
          <label>
            <input type="checkbox" class="med-checkbox" value="lamotrigine" />
            Lamotrigine
          </label>
          <label>
            <input type="checkbox" class="med-checkbox" value="lacosamide" />
            Lacosamide
          </label>
          <label>
            <input type="checkbox" class="med-checkbox" value="valproate" />
            Valproate
          </label>
          <label>
            <input type="checkbox" class="med-checkbox" value="clobazam" />
            Clobazam
          </label>
        </div>
      </fieldset>

      <!-- 3. Conditional sections -->
      <fieldset>
        <legend>Sections to Include</legend>
        <label>
          <input type="checkbox" class="section-checkbox" value="hpi" checked />
          Include HPI
        </label>
        <label>
          <input type="checkbox" class="section-checkbox" value="exam" checked />
          Include Exam
        </label>
        <label>
          <input type="checkbox" class="section-checkbox" value="plan" checked />
          Include Plan
        </label>
        <label>
          <input type="checkbox" class="section-checkbox" value="safety" />
          Include Safety / Counseling Blurb
        </label>
      </fieldset>
    </div>

    <!-- RIGHT: output -->
    <div>
      <div class="output-header">
        <strong>Generated Text</strong>
        <button id="copy-btn" type="button">Copy</button>
      </div>
      <textarea id="output" readonly></textarea>
      <p id="copy-status" class="small"></p>
    </div>
  </div>

  <script>
    // Map visit type to phrase templates
    const visitTypeTemplates = {
      new: "New patient seen today for initial evaluation of [chief complaint].",
      followup: "Patient seen in follow-up for ongoing management of [chief complaint].",
      urgent: "Patient seen on urgent basis today for acute change in [symptom/complaint]."
    };

    // Simple medication label map for friendly output
    const medLabels = {
      levetiracetam: "levetiracetam",
      lamotrigine: "lamotrigine",
      lacosamide: "lacosamide",
      valproate: "valproate",
      clobazam: "clobazam"
    };

    // Section templates
    function buildHPI(visitTypeText) {
      return (
        "HPI:\n" +
        visitTypeText + "\n" +
        "Onset: [onset]. Course: [course]. Triggers: [triggers].\n"
      );
    }

    function buildExam() {
      return (
        "Exam:\n" +
        "Mental status: [mental status]. Cranial nerves: [CN]. Motor: [motor]. Sensory: [sensory]. Gait: [gait].\n"
      );
    }

    function buildPlan(selectedMedsText) {
      const medsSentence = selectedMedsText
        ? "Current anti-seizure regimen includes " + selectedMedsText + ". "
        : "Current regimen reviewed. ";

      return (
        "Plan:\n" +
        medsSentence +
        "Adjustments: [dose changes / new meds]. Diagnostics: [EEG/MRI/labs]. Follow-up: [interval].\n"
      );
    }

    function buildSafety() {
      return (
        "Safety / Counseling:\n" +
        "Reviewed seizure precautions, driving restrictions per state law, and medication side effect profile.\n"
      );
    }

    function getSelectedVisitType() {
      const radios = document.querySelectorAll('input[name="visitType"]');
      for (const r of radios) {
        if (r.checked) return r.value;
      }
      return "new";
    }

    function getSelectedMeds() {
      const meds = Array.from(document.querySelectorAll(".med-checkbox"))
        .filter((cb) => cb.checked)
        .map((cb) => medLabels[cb.value] || cb.value);
      return meds;
    }

    function getSelectedSections() {
      return Array.from(document.querySelectorAll(".section-checkbox"))
        .filter((cb) => cb.checked)
        .map((cb) => cb.value);
    }

    function formatMedList(meds) {
      if (meds.length === 0) return "";
      if (meds.length === 1) return meds[0];
      if (meds.length === 2) return meds[0] + " and " + meds[1];
      return meds.slice(0, -1).join(", ") + ", and " + meds[meds.length - 1];
    }

    function buildOutput() {
      const visitTypeKey = getSelectedVisitType();
      const visitTypeText = visitTypeTemplates[visitTypeKey];
      const meds = getSelectedMeds();
      const medListText = formatMedList(meds);
      const sections = getSelectedSections();

      const blocks = [];

      if (sections.includes("hpi")) {
        blocks.push(buildHPI(visitTypeText));
      }
      if (sections.includes("exam")) {
        blocks.push(buildExam());
      }
      if (sections.includes("plan")) {
        blocks.push(buildPlan(medListText));
      }
      if (sections.includes("safety")) {
        blocks.push(buildSafety());
      }

      const finalText = blocks.join("\n");

      document.getElementById("output").value = finalText;
    }

    // Copy to clipboard
    async function copyOutput() {
      const outputEl = document.getElementById("output");
      const statusEl = document.getElementById("copy-status");
      const text = outputEl.value;

      if (!text.trim()) {
        statusEl.textContent = "Nothing to copy yet.";
        return;
      }

      try {
        await navigator.clipboard.writeText(text);
        statusEl.textContent = "Copied!";
      } catch (err) {
        // Fallback
        outputEl.select();
        document.execCommand("copy");
        statusEl.textContent = "Copied (fallback).";
      }

      setTimeout(() => {
        statusEl.textContent = "";
      }, 2000);
    }

    // Wire up listeners
    function init() {
      const allInputs = document.querySelectorAll(
        'input[name="visitType"], .med-checkbox, .section-checkbox'
      );
      allInputs.forEach((el) => {
        el.addEventListener("change", buildOutput);
      });

      document
        .getElementById("copy-btn")
        .addEventListener("click", copyOutput);

      // Initial render
      buildOutput();
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
